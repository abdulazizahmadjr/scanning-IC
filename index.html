<!DOCTYPE html>
<html>
<head>
    <title>Scan Barcode + Export Excel</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body { font-family: Arial; text-align: center; }
        #reader { width: 300px; margin: auto; }
        table { margin: auto; margin-top: 20px; border-collapse: collapse; }
        th, td { border: 1px solid black; padding: 8px; }
        button { margin: 5px; padding: 10px; }
    </style>
</head>
<body>

<h2>Aplikasi Scan Barcode</h2>

<div id="reader"></div>

<button onclick="exportExcel()">Export ke Excel</button>
<button onclick="resetData()">Reset Data</button>

<table id="dataTable">
    <thead>
        <tr>
            <th>No</th>
            <th>Barcode</th>
            <th>Waktu Scan</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<script>
let data = [];
let count = 1;

function onScanSuccess(decodedText) {
    let waktu = new Date().toLocaleString();
    data.push({No: count, Barcode: decodedText, Waktu: waktu});

    let table = document.getElementById("dataTable").getElementsByTagName('tbody')[0];
    let row = table.insertRow();
    row.insertCell(0).innerHTML = count;
    row.insertCell(1).innerHTML = decodedText;
    row.insertCell(2).innerHTML = waktu;

    count++;
}

let html5QrcodeScanner = new Html5QrcodeScanner(
    "reader", { fps: 10, qrbox: 250 });
html5QrcodeScanner.render(onScanSuccess);

function exportExcel() {
    let ws = XLSX.utils.json_to_sheet(data);
    let wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "Hasil Scan");
    XLSX.writeFile(wb, "Hasil_Scan.xlsx");
}

function resetData() {
    data = [];
    count = 1;
    document.querySelector("#dataTable tbody").innerHTML = "";
}
</script>

</body>
</html>
